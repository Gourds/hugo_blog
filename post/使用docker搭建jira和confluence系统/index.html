<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>使用Docker搭建Jira和Confluence系统 - Gourds</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="Gourds" />
  <meta name="description" content="**整理补个文档：**这周折腾了两天Jira和Confluence，准备用这个来代替现在使用的phabricator，Phabricator这个是开源的，Jira和Confluence时Atlassian公司的商业产品，具体如何选择看公司爱好吧。为简化测试和正式部署使用，采取Docker的方式进行安装部署。这里记录一下安装过程和一些避坑建议。另外多说一句Altlassian公司的产品还都蛮好用的，譬如Sourcetree。以下的脚本在【Github】上都有
 **JIRA是Atlassian公司出品的项目与事务跟踪工具，被广泛应用于缺陷跟踪、客户服务、需求收集、流程审批、任务跟踪、项目跟踪和敏捷管理等工作领域。 Confluence是一个专业的企业知识管理与协同软件，也可以用于构建企业wiki。使用简单，但它强大的编辑和站点管理特征能够帮助团队成员之间共享信息、文档协作、集体讨论，信息推送。 Phabricator**是一套基于Web的软件开发协作工具，一个Web应用用于帮助软件公司构建更好的软件。原是facebook员工开发的可视化代码评审工具,主要功能有CodeReview、代码托管、Bug跟踪、Task管理、Wiki文档等功能。
" />

  <meta name="keywords" content="Hugo, theme, jane" />






<meta name="generator" content="Hugo 0.85.0" />


<link rel="canonical" href="http://blog.gourds.site/post/%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BAjira%E5%92%8Cconfluence%E7%B3%BB%E7%BB%9F/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.b3a8813c06e6d785beba22bf8264e174fa2cb3a396b22f9ba24e2c00c18aaf7f.css" integrity="sha256-s6iBPAbm14W&#43;uiK/gmThdPoss6OWsi&#43;bok4sAMGKr38=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="使用Docker搭建Jira和Confluence系统" />
<meta property="og:description" content="**整理补个文档：**这周折腾了两天Jira和Confluence，准备用这个来代替现在使用的phabricator，Phabricator这个是开源的，Jira和Confluence时Atlassian公司的商业产品，具体如何选择看公司爱好吧。为简化测试和正式部署使用，采取Docker的方式进行安装部署。这里记录一下安装过程和一些避坑建议。另外多说一句Altlassian公司的产品还都蛮好用的，譬如Sourcetree。以下的脚本在【Github】上都有

**JIRA是Atlassian公司出品的项目与事务跟踪工具，被广泛应用于缺陷跟踪、客户服务、需求收集、流程审批、任务跟踪、项目跟踪和敏捷管理等工作领域。
Confluence是一个专业的企业知识管理与协同软件，也可以用于构建企业wiki。使用简单，但它强大的编辑和站点管理特征能够帮助团队成员之间共享信息、文档协作、集体讨论，信息推送。
Phabricator**是一套基于Web的软件开发协作工具，一个Web应用用于帮助软件公司构建更好的软件。原是facebook员工开发的可视化代码评审工具,主要功能有CodeReview、代码托管、Bug跟踪、Task管理、Wiki文档等功能。
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://blog.gourds.site/post/%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BAjira%E5%92%8Cconfluence%E7%B3%BB%E7%BB%9F/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2018-04-14T15:47:00+00:00" />
<meta property="article:modified_time" content="2018-04-14T15:47:00+00:00" />

<meta itemprop="name" content="使用Docker搭建Jira和Confluence系统">
<meta itemprop="description" content="**整理补个文档：**这周折腾了两天Jira和Confluence，准备用这个来代替现在使用的phabricator，Phabricator这个是开源的，Jira和Confluence时Atlassian公司的商业产品，具体如何选择看公司爱好吧。为简化测试和正式部署使用，采取Docker的方式进行安装部署。这里记录一下安装过程和一些避坑建议。另外多说一句Altlassian公司的产品还都蛮好用的，譬如Sourcetree。以下的脚本在【Github】上都有

**JIRA是Atlassian公司出品的项目与事务跟踪工具，被广泛应用于缺陷跟踪、客户服务、需求收集、流程审批、任务跟踪、项目跟踪和敏捷管理等工作领域。
Confluence是一个专业的企业知识管理与协同软件，也可以用于构建企业wiki。使用简单，但它强大的编辑和站点管理特征能够帮助团队成员之间共享信息、文档协作、集体讨论，信息推送。
Phabricator**是一套基于Web的软件开发协作工具，一个Web应用用于帮助软件公司构建更好的软件。原是facebook员工开发的可视化代码评审工具,主要功能有CodeReview、代码托管、Bug跟踪、Task管理、Wiki文档等功能。
"><meta itemprop="datePublished" content="2018-04-14T15:47:00+00:00" />
<meta itemprop="dateModified" content="2018-04-14T15:47:00+00:00" />
<meta itemprop="wordCount" content="2723">
<meta itemprop="keywords" content="Jira,Docker,Confluence," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="使用Docker搭建Jira和Confluence系统"/>
<meta name="twitter:description" content="**整理补个文档：**这周折腾了两天Jira和Confluence，准备用这个来代替现在使用的phabricator，Phabricator这个是开源的，Jira和Confluence时Atlassian公司的商业产品，具体如何选择看公司爱好吧。为简化测试和正式部署使用，采取Docker的方式进行安装部署。这里记录一下安装过程和一些避坑建议。另外多说一句Altlassian公司的产品还都蛮好用的，譬如Sourcetree。以下的脚本在【Github】上都有

**JIRA是Atlassian公司出品的项目与事务跟踪工具，被广泛应用于缺陷跟踪、客户服务、需求收集、流程审批、任务跟踪、项目跟踪和敏捷管理等工作领域。
Confluence是一个专业的企业知识管理与协同软件，也可以用于构建企业wiki。使用简单，但它强大的编辑和站点管理特征能够帮助团队成员之间共享信息、文档协作、集体讨论，信息推送。
Phabricator**是一套基于Web的软件开发协作工具，一个Web应用用于帮助软件公司构建更好的软件。原是facebook员工开发的可视化代码评审工具,主要功能有CodeReview、代码托管、Bug跟踪、Task管理、Wiki文档等功能。
"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">进击de葫芦娃</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://blog.gourds.site/">首页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://blog.gourds.site/post/">归档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://blog.gourds.site/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://blog.gourds.site/categories/">分类</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://wiki.gourds.site" rel="noopener" target="_blank">
              Wiki
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      进击de葫芦娃
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://blog.gourds.site/">首页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://blog.gourds.site/post/">归档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://blog.gourds.site/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://blog.gourds.site/categories/">分类</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://wiki.gourds.site" rel="noopener" target="_blank">
              Wiki
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">使用Docker搭建Jira和Confluence系统</h1>
      
      <div class="post-meta">
        <time datetime="2018-04-14" class="post-time">
          2018-04-14
        </time>
        
        

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#环境准备">环境准备</a></li>
        <li><a href="#安装myql">安装Myql</a></li>
        <li><a href="#安装jira">安装Jira</a></li>
        <li><a href="#安装confluence">安装Confluence</a></li>
        <li><a href="#数据备份">数据备份</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <p>**整理补个文档：**这周折腾了两天Jira和Confluence，准备用这个来代替现在使用的phabricator，Phabricator这个是开源的，Jira和Confluence时Atlassian公司的商业产品，具体如何选择看公司爱好吧。为简化测试和正式部署使用，采取Docker的方式进行安装部署。这里记录一下安装过程和一些避坑建议。另外多说一句Altlassian公司的产品还都蛮好用的，譬如Sourcetree。以下的脚本在<a href="https://github.com/Gourds/docker-image/tree/master/Service/jira_confluence">【Github】</a>上都有</p>
<blockquote>
<p>**<a href="https://www.atlassian.com/software/jira">JIRA</a><strong>是Atlassian公司出品的项目与事务跟踪工具，被广泛应用于缺陷跟踪、客户服务、需求收集、流程审批、任务跟踪、项目跟踪和敏捷管理等工作领域。
</strong><a href="https://www.atlassian.com/software/confluence">Confluence</a><strong>是一个专业的企业知识管理与协同软件，也可以用于构建企业wiki。使用简单，但它强大的编辑和站点管理特征能够帮助团队成员之间共享信息、文档协作、集体讨论，信息推送。
</strong><a href="https://github.com/phacility/phabricator">Phabricator</a>**是一套基于Web的软件开发协作工具，一个Web应用用于帮助软件公司构建更好的软件。原是facebook员工开发的可视化代码评审工具,主要功能有CodeReview、代码托管、Bug跟踪、Task管理、Wiki文档等功能。</p>
</blockquote>
<h3 id="环境准备">环境准备</h3>
<p><strong>本地实践环境:</strong></p>
<blockquote>
<p>OS：<code>CentOS Linux release 7.2.1511 (Core)</code>
Docker:<code>v1.13.1</code></p>
</blockquote>
<p><strong>启动Docker并将Docker添加至开机启动</strong></p>
<ul>
<li>在Centos7上</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yum install docker -y
systemctl enable docker.service
systemctl start docker.service
</code></pre></div><ul>
<li>在Centos6及Amazon Linux上</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yum install docker -y
chkconfig --add docker
/etc/init.d/docker start
</code></pre></div><p><strong>Iptables及SELinux设置</strong></p>
<ul>
<li>在Centos7上</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#SELinux disabled</span>
setenforce <span style="color:#ae81ff">0</span>
sed -i <span style="color:#e6db74">&#39;s/^SELINUX=enforcing/SELINUX=disabled/g&#39;</span> /etc/sysconfig/selinux
getenforce
<span style="color:#75715e">#Iptables setup</span>
yum install iptables-services
iptables -I  INPUT -p tcp --dport <span style="color:#ae81ff">3306</span> -j ACCEPT
iptables -I  INPUT -p tcp --dport <span style="color:#ae81ff">18080</span> -j ACCEPT
iptables -I  INPUT -p tcp --dport <span style="color:#ae81ff">8090</span> -j ACCEPT
service iptables save
<span style="color:#75715e">#Other Command(Don&#39;t config)</span>
<span style="color:#75715e">#systemctl stop firewalld.service</span>
<span style="color:#75715e">#systemctl disable firewalld.service</span>
</code></pre></div><h3 id="安装myql">安装Myql</h3>
<p>使用官方镜像直接启动容器即可。不过使用Jira和Confluence时需要添加几个mysql启动配置,具体可参考<a href="https://hub.docker.com/_/mysql/">【Mysql镜像说明】</a>，<code>packet</code>及<code>log_file_size</code>参数为应用要求防止大文件无法存储，<code>utf8</code>是为了支持中文</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run --name mysql -p 3306:3306 -v /data/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD<span style="color:#f92672">=</span>yourpasswd -idt mysql/mysql-server:latest --character-set-server<span style="color:#f92672">=</span>utf8 --collation-server<span style="color:#f92672">=</span>utf8_bin --max_allowed_packet<span style="color:#f92672">=</span>512M --innodb_log_file_size<span style="color:#f92672">=</span>2GB
<span style="color:#75715e">#docker run -it --rm docker.io/mysql/mysql-server --verbose --help</span>
docker ps -a <span style="color:#75715e">#查看容器状态</span>
docker exec -it mysql /bin/bash <span style="color:#75715e">#进入容器，PS由于mysql启动后root用户监听localhost所以创建Database时需要进入容器内部</span>
</code></pre></div><ul>
<li>创建Jira数据库</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#mysql&gt; show variables like &#39;char%&#39;;</span>
mysql&gt; CREATE DATABASE jira_db CHARACTER SET utf8 COLLATE utf8_bin;
mysql&gt; grant ALL PRIVILEGES on jira_db.* to jira_user@<span style="color:#e6db74">&#34;%&#34;</span> Identified by <span style="color:#e6db74">&#34;yourpassword;
</span><span style="color:#e6db74">mysql&gt; SHOW CREATE DATABASE jira_db;
</span><span style="color:#e6db74">mysql&gt; flush privileges;
</span></code></pre></div><ul>
<li>创建Confluence数据库</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#mysql&gt; show variables like &#39;char%&#39;;</span>
mysql&gt; create database confluence CHARACTER SET utf8 COLLATE utf8_bin;
mysql&gt; grant ALL PRIVILEGES on confluence.* to confluence_user@<span style="color:#e6db74">&#34;%&#34;</span> Identified by <span style="color:#e6db74">&#34;yourpassword&#34;</span>;
mysql&gt; SHOW CREATE DATABASE confluence;
mysql&gt; flush privileges;
</code></pre></div><ul>
<li>创建数据库备份用户</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mysql&gt; grant <span style="color:#66d9ef">select</span> on *.* to backup_user@<span style="color:#e6db74">&#34;%&#34;</span> Identified by <span style="color:#e6db74">&#34;yourpassword&#34;</span>;
mysql&gt; flush privileges;
</code></pre></div><h3 id="安装jira">安装Jira</h3>
<p>使用官方镜像直接启动Jira容器。这个服务没有太多问题，注意端口是否监听正确及相关端口（数据库端口、应用端口）是否放开，这里的端口放开是指本机防火墙，外网防火墙不应放行数据库端口</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run -p 18080:8080 -dit --name jira docker.io/cptactionhank/atlassian-jira
<span style="color:#75715e">#Manage Application</span>
docker ps
docker exec -it jira /bin/bash
docker stop jira
docker start jira
docker logs jira
docker logs -f jira
</code></pre></div><p>在浏览器访问<code>http://host_address:18080</code>跟着提示安装即可。</p>
<h3 id="安装confluence">安装Confluence</h3>
<p>由于Jira使用的是MySQL方便起见Confluence也要用Mysql，但是使用官方镜像会有以下问题</p>
<blockquote>
<p>a.官方的对于PostSQL支持可以,但无法直接连接mysql需要自行安装支持java连接mysql的组件
b.中文Office在Confluence的预览查看会出现乱码情况，需要修改confluence连接参数及自行添加中文字体库
c.官方使用了不受支持的<code>openjdk</code>，需要更改jdk环境为<code>Oracle JDK</code></p>
</blockquote>
<p>鉴于这种情况使用这个官方镜像就很不理智了，还希望使用docker，只能自己做一个镜像了</p>
<h4 id="制作镜像">制作镜像</h4>
<ul>
<li>准备工作</li>
</ul>
<blockquote>
<ul>
<li><strong>Step 1:</strong> 下载<code>java-mysql</code>
可以从Mysql官方<a href="https://dev.mysql.com/downloads/file/?id=476197">【下载地址】</a>进行下载解压，只需要其中的两个文件，按下面的目录结构存放就可以了
<strong>Step 2:</strong> 准备中文字体库
这个可以从身边现成的windows机器上直接压缩拷贝过来就行了，windows下的字体存放在<code>C:\Windows\Fonts</code>,然后按下面的目录结构存放就可以了，注意这个压缩包需要和我下面目录的一直，不然需要自行更改<code>Dockerfile</code>文件,还有这个压缩包应该是解压完后是<code>Fonts/字体</code>这样的结构。</li>
</ul>
</blockquote>
<ul>
<li>构建的目录结构</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">├── chinese-win.tar.gz
├── Dockerfile
├── entrypoint.sh
├── java-mysql
    ├── mysql-connector-java-5.1.46-bin.jar
    └── mysql-connector-java-5.1.46.jar
</code></pre></div><ul>
<li>构建文件及启动脚本
主构建文件<code>Dockerfile</code>如下</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">FROM anapsix/alpine-java:8_jdk
LABEL <span style="color:#e6db74">&#34;Author&#34;</span>:<span style="color:#e6db74">&#34;arvon2014@gmail.com&#34;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>      <span style="color:#e6db74">&#34;Date&#34;</span>:<span style="color:#e6db74">&#34;2018-04-11&#34;</span>
ENV RUN_USER  daemon
ENV RUN_GROUP daemon
ENV CONFLUENCE_HOME /var/atlassian/application-data/confluence
ENV CONFLUENCE_INSTALL_DIR   /opt/atlassian/confluence
<span style="color:#75715e">#</span>
VOLUME <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CONFLUENCE_HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">]</span>
<span style="color:#75715e">#</span>
EXPOSE <span style="color:#ae81ff">8090</span>
EXPOSE <span style="color:#ae81ff">8091</span>
WORKDIR $CONFLUENCE_HOME
RUN apk update -qq <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> update-ca-certificates <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> apk add ca-certificates wget curl openssh bash procps openssl perl ttf-dejavu tini<span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> rm -rf /var/lib/<span style="color:#f92672">{</span>apt,dpkg,cache,log<span style="color:#f92672">}</span>/ /tmp/* /var/tmp/* <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> mkdir -p  <span style="color:#e6db74">${</span>CONFLUENCE_INSTALL_DIR<span style="color:#e6db74">}</span>
ARG CONFLUENCE_VERSION<span style="color:#f92672">=</span>6.8.1
ARG DOWNLOAD_URL<span style="color:#f92672">=</span>http://www.atlassian.com/software/confluence/downloads/binary/atlassian-confluence-<span style="color:#e6db74">${</span>CONFLUENCE_VERSION<span style="color:#e6db74">}</span>.tar.gz
RUN curl -L --silent                  <span style="color:#e6db74">${</span>DOWNLOAD_URL<span style="color:#e6db74">}</span> | tar -xz --strip-components<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> -C <span style="color:#e6db74">&#34;</span>$CONFLUENCE_INSTALL_DIR<span style="color:#e6db74">&#34;</span>
ADD chinese-win.tar.gz  /usr/share/fonts/
<span style="color:#75715e">#RUN fc-cache -fv</span>
<span style="color:#75715e">#ADD atlassian-confluence-6.8.1.tar.gz $CONFLUENCE_INSTALL_DIR/</span>
RUN chown -R <span style="color:#e6db74">${</span>RUN_USER<span style="color:#e6db74">}</span>:<span style="color:#e6db74">${</span>RUN_GROUP<span style="color:#e6db74">}</span> <span style="color:#e6db74">${</span>CONFLUENCE_INSTALL_DIR<span style="color:#e6db74">}</span>/ <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> sed -i -e <span style="color:#e6db74">&#39;s/-Xms\([0-9]\+[kmg]\) -Xmx\([0-9]\+[kmg]\)/-Xms\${JVM_MINIMUM_MEMORY:=\1} -Xmx\${JVM_MAXIMUM_MEMORY:=\2} \${JVM_SUPPORT_RECOMMENDED_ARGS} -Dconfluence.home=\${CONFLUENCE_HOME}/g&#39;</span> <span style="color:#e6db74">${</span>CONFLUENCE_INSTALL_DIR<span style="color:#e6db74">}</span>/bin/setenv.sh <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span><span style="color:#75715e">#    &amp;&amp; sed -i -e &#39;/.*-Dconfluence.context.path=.*/a\CATALINA_OPTS=&#34;-Dconfluence.document.conversion.fontpath=/usr/share/fonts/Fonts/ ${CATALINA_OPTS}&#34;&#39; ${CONFLUENCE_INSTALL_DIR}/bin/setenv.sh \</span>
    <span style="color:#f92672">&amp;&amp;</span> sed -i -e <span style="color:#e6db74">&#39;s/port=&#34;8090&#34;/port=&#34;8090&#34; secure=&#34;${catalinaConnectorSecure}&#34; scheme=&#34;${catalinaConnectorScheme}&#34; proxyName=&#34;${catalinaConnectorProxyName}&#34; proxyPort=&#34;${catalinaConnectorProxyPort}&#34;/&#39;</span> <span style="color:#e6db74">${</span>CONFLUENCE_INSTALL_DIR<span style="color:#e6db74">}</span>/conf/server.xml
COPY entrypoint.sh              /entrypoint.sh
COPY java-mysql/mysql-connector-java-5.1.46.jar /opt/atlassian/confluence/confluence/WEB-INF/lib/mysql-connector-java-5.1.46.jar
COPY java-mysql/mysql-connector-java-5.1.46-bin.jar /opt/atlassian/confluence/confluence/WEB-INF/lib/mysql-connector-java-5.1.46-bin.jar
<span style="color:#75715e">#</span>
RUN chown -R <span style="color:#e6db74">${</span>RUN_USER<span style="color:#e6db74">}</span>:<span style="color:#e6db74">${</span>RUN_GROUP<span style="color:#e6db74">}</span> <span style="color:#e6db74">${</span>CONFLUENCE_INSTALL_DIR<span style="color:#e6db74">}</span>/
<span style="color:#75715e">#</span>
CMD <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;/entrypoint.sh&#34;</span>, <span style="color:#e6db74">&#34;-fg&#34;</span><span style="color:#f92672">]</span>
ENTRYPOINT <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;/sbin/tini&#34;</span>, <span style="color:#e6db74">&#34;--&#34;</span><span style="color:#f92672">]</span>
<span style="color:#75715e">#</span>
<span style="color:#75715e">#CMD tail -f /entrypoint.sh</span>
</code></pre></div><ul>
<li>启动脚本<code>entrypoint.sh</code>如下</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>set -euo pipefail
<span style="color:#75715e"># Setup Catalina Opts</span>
: <span style="color:#e6db74">${</span>CATALINA_CONNECTOR_PROXYNAME:=<span style="color:#e6db74">}</span>
: <span style="color:#e6db74">${</span>CATALINA_CONNECTOR_PROXYPORT:=<span style="color:#e6db74">}</span>
: <span style="color:#e6db74">${</span>CATALINA_CONNECTOR_SCHEME:=http<span style="color:#e6db74">}</span>
: <span style="color:#e6db74">${</span>CATALINA_CONNECTOR_SECURE:=false<span style="color:#e6db74">}</span>
: <span style="color:#e6db74">${</span>CATALINA_OPTS:=<span style="color:#e6db74">}</span>
CATALINA_OPTS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CATALINA_OPTS<span style="color:#e6db74">}</span><span style="color:#e6db74"> -DcatalinaConnectorProxyName=</span><span style="color:#e6db74">${</span>CATALINA_CONNECTOR_PROXYNAME<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
CATALINA_OPTS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CATALINA_OPTS<span style="color:#e6db74">}</span><span style="color:#e6db74"> -DcatalinaConnectorProxyPort=</span><span style="color:#e6db74">${</span>CATALINA_CONNECTOR_PROXYPORT<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
CATALINA_OPTS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CATALINA_OPTS<span style="color:#e6db74">}</span><span style="color:#e6db74"> -DcatalinaConnectorScheme=</span><span style="color:#e6db74">${</span>CATALINA_CONNECTOR_SCHEME<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
CATALINA_OPTS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CATALINA_OPTS<span style="color:#e6db74">}</span><span style="color:#e6db74"> -DcatalinaConnectorSecure=</span><span style="color:#e6db74">${</span>CATALINA_CONNECTOR_SECURE<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
export CATALINA_OPTS
<span style="color:#75715e"># Start Confluence as the correct user</span>
<span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>UID<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> -eq <span style="color:#ae81ff">0</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
    echo <span style="color:#e6db74">&#34;User is currently root. Will change directory ownership to </span><span style="color:#e6db74">${</span>RUN_USER<span style="color:#e6db74">}</span><span style="color:#e6db74">:</span><span style="color:#e6db74">${</span>RUN_GROUP<span style="color:#e6db74">}</span><span style="color:#e6db74">, then downgrade permission to </span><span style="color:#e6db74">${</span>RUN_USER<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
    PERMISSIONS_SIGNATURE<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>stat -c <span style="color:#e6db74">&#34;%u:%U:%a&#34;</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CONFLUENCE_HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">)</span>
    EXPECTED_PERMISSIONS<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>id -u <span style="color:#e6db74">${</span>RUN_USER<span style="color:#e6db74">}</span><span style="color:#66d9ef">)</span>:<span style="color:#e6db74">${</span>RUN_USER<span style="color:#e6db74">}</span>:700
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>PERMISSIONS_SIGNATURE<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> !<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>EXPECTED_PERMISSIONS<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
        chmod -R <span style="color:#ae81ff">700</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CONFLUENCE_HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">&amp;&amp;</span>
            chown -R <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>RUN_USER<span style="color:#e6db74">}</span><span style="color:#e6db74">:</span><span style="color:#e6db74">${</span>RUN_GROUP<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>CONFLUENCE_HOME<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
    <span style="color:#66d9ef">fi</span>
    <span style="color:#75715e"># Now drop privileges</span>
    exec su -s /bin/bash <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>RUN_USER<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> -c <span style="color:#e6db74">&#34;</span>$CONFLUENCE_INSTALL_DIR<span style="color:#e6db74">/bin/start-confluence.sh </span>$@<span style="color:#e6db74">&#34;</span>
<span style="color:#66d9ef">else</span>
    exec <span style="color:#e6db74">&#34;</span>$CONFLUENCE_INSTALL_DIR<span style="color:#e6db74">/bin/start-confluence.sh&#34;</span> <span style="color:#e6db74">&#34;</span>$@<span style="color:#e6db74">&#34;</span>
<span style="color:#66d9ef">fi</span>
</code></pre></div><ul>
<li>构建镜像</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ls <span style="color:#75715e">#进入dockerfile同级目录</span>
docker build -t confluence-oracle-jdk:v6.8.1 . --no-cache <span style="color:#75715e">#构建镜像，这个需要一点时间，建议使用Tmux</span>
docker images <span style="color:#75715e">#查看镜像</span>
</code></pre></div><h4 id="启动confluence">启动Confluence</h4>
<p>主要问题一般会出在构建阶段，如果启动失败可以尝试注释<code>Dockerfile</code>的启动命令，然后进入容器手动调试</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run -v /data/confluence:/var/atlassian/application-data/confluence --name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;confluence&#34;</span> -d -p 8090:8090 -p 8091:8091 confluence-oracle-jdk:v6.8.1 <span style="color:#75715e">#调试期间可以加上 --rm参数</span>
<span style="color:#75715e">#Manage Confluence</span>
docker ps
docker exec -it confluence /bin/bash
docker stop confluence
docker start confluence
docker logs confluence
docker logs -f confluence
</code></pre></div><p>容器启动后跟Jira一样检查端口和防火墙配置,确认没问题后，在浏览器访问<code>http://host_address:8090</code>跟着提示安装，<strong>注意</strong>在web界面连接数据库的时候需要选择<code>String</code>模式，然后按照如下参数填写,如果没来得及修改，可以在<code>/data/confluence/confluence.cfg.xml</code>这个配置里修改重启。另外如需链接Jira在最后根据提示选择就可以了，别的就没啥了。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">jdbc:mysql://host_address:3306/confluence?sessionVariables<span style="color:#f92672">=</span>tx_isolation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;READ-COMMITTED&#39;</span>&amp;useSSL<span style="color:#f92672">=</span>false&amp;useUnicode<span style="color:#f92672">=</span>true&amp;characterEncoding<span style="color:#f92672">=</span>utf8
<span style="color:#75715e"># Answer：https://confluence.atlassian.com/confkb/confluence-fails-to-start-and-throws-mysql-session-isolation-level-repeatable-read-is-no-longer-supported-error-241568536.html</span>
</code></pre></div><h3 id="数据备份">数据备份</h3>
<p>奉上一个拙劣的脚本，还能使就懒的改了,对了在非<code>Amazon Linux</code>上，传S3记得装<code>pip install awscli --upgrade</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#* * 3 * * sh /data/arvon/scripts</span>
ipaddr<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;10.0.1.7&#39;</span>
username<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;backup_user&#39;</span>
password<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;yourpasswd&#39;</span>
dest_dir<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;/data/mysql_data_bak&#39;</span>
<span style="color:#75715e">###</span>
<span style="color:#66d9ef">function</span> dump_db<span style="color:#f92672">(){</span>
all_area<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>echo <span style="color:#e6db74">&#34;show databases&#34;</span> | mysql -h<span style="color:#e6db74">${</span>ipaddr<span style="color:#e6db74">}</span> -u<span style="color:#e6db74">${</span>username<span style="color:#e6db74">}</span> -p<span style="color:#e6db74">${</span>password<span style="color:#e6db74">}</span> |egrep -v <span style="color:#e6db74">&#34;information_schema|mysql|performance_schema|Database|sys&#34;</span><span style="color:#e6db74">`</span>
mkdir <span style="color:#e6db74">${</span>dest_dir<span style="color:#e6db74">}</span>/<span style="color:#e6db74">`</span>date +%F<span style="color:#e6db74">`</span> -p
<span style="color:#66d9ef">for</span> area in $all_area;<span style="color:#66d9ef">do</span>
    mysqldump -h<span style="color:#e6db74">${</span>ipaddr<span style="color:#e6db74">}</span> -u<span style="color:#e6db74">${</span>username<span style="color:#e6db74">}</span> -p<span style="color:#e6db74">${</span>password<span style="color:#e6db74">}</span> --default-character-set<span style="color:#f92672">=</span>utf8 --comments<span style="color:#f92672">=</span>FALSE --tables --no-create-info<span style="color:#f92672">=</span>FALSE --add-drop-table<span style="color:#f92672">=</span>TRUE --no-data<span style="color:#f92672">=</span>FALSE <span style="color:#e6db74">${</span>area<span style="color:#e6db74">}</span>  &gt;<span style="color:#e6db74">${</span>dest_dir<span style="color:#e6db74">}</span>/<span style="color:#e6db74">`</span>date +%F<span style="color:#e6db74">`</span>/<span style="color:#e6db74">`</span>date +%F<span style="color:#e6db74">`</span>_<span style="color:#e6db74">${</span>area<span style="color:#e6db74">}</span>.sql
    cd <span style="color:#e6db74">${</span>dest_dir<span style="color:#e6db74">}</span>/<span style="color:#e6db74">`</span>date +%F<span style="color:#e6db74">`</span>  <span style="color:#f92672">&amp;&amp;</span> tar czvf <span style="color:#e6db74">`</span>date +%F<span style="color:#e6db74">`</span>_<span style="color:#e6db74">${</span>area<span style="color:#e6db74">}</span>.sql.tar.gz <span style="color:#e6db74">`</span>date +%F<span style="color:#e6db74">`</span>_<span style="color:#e6db74">${</span>area<span style="color:#e6db74">}</span>.sql <span style="color:#f92672">&amp;&amp;</span> rm -rf <span style="color:#e6db74">`</span>date +%F<span style="color:#e6db74">`</span>_<span style="color:#e6db74">${</span>area<span style="color:#e6db74">}</span>.sql
    echo <span style="color:#e6db74">&#34;[`date +%F_%R`] [INFO] Now the `date +%F`_</span><span style="color:#e6db74">${</span>area<span style="color:#e6db74">}</span><span style="color:#e6db74">.sql have been backuped&#34;</span> &gt;&gt; /var/log/mysql_back.log
<span style="color:#66d9ef">done</span>
<span style="color:#f92672">}</span>
<span style="color:#66d9ef">function</span> load_db<span style="color:#f92672">(){</span>
<span style="color:#75715e">#usage:load_db 2017-05-23</span>
time_want<span style="color:#f92672">=</span>$1
mysql -h<span style="color:#e6db74">${</span>ipaddr<span style="color:#e6db74">}</span> -u<span style="color:#e6db74">${</span>username<span style="color:#e6db74">}</span> -p<span style="color:#e6db74">${</span>password<span style="color:#e6db74">}</span> --default-character-set<span style="color:#f92672">=</span>utf8 --execute<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;DROP DATABASE IF EXISTS  </span><span style="color:#e6db74">${</span>area<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>;
mysql -h<span style="color:#e6db74">${</span>ipaddr<span style="color:#e6db74">}</span> -u<span style="color:#e6db74">${</span>username<span style="color:#e6db74">}</span> -p<span style="color:#e6db74">${</span>password<span style="color:#e6db74">}</span> --default-character-set<span style="color:#f92672">=</span>utf8 --execute<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;CREATE DATABASE IF NOT EXISTS  </span><span style="color:#e6db74">${</span>area<span style="color:#e6db74">}</span><span style="color:#e6db74"> DEFAULT CHARACTER SET utf8&#34;</span>;
mysql -h<span style="color:#e6db74">${</span>ipaddr<span style="color:#e6db74">}</span> -u<span style="color:#e6db74">${</span>username<span style="color:#e6db74">}</span> -p<span style="color:#e6db74">${</span>password<span style="color:#e6db74">}</span> --default-character-set<span style="color:#f92672">=</span>utf8 --database<span style="color:#f92672">=</span> <span style="color:#e6db74">${</span>area<span style="color:#e6db74">}</span> &lt;<span style="color:#e6db74">${</span>dest_dir<span style="color:#e6db74">}</span>/<span style="color:#e6db74">${</span>time_want<span style="color:#e6db74">}</span>_<span style="color:#e6db74">${</span>area<span style="color:#e6db74">}</span>.sql;
<span style="color:#f92672">}</span>
<span style="color:#66d9ef">function</span> upload_s3<span style="color:#f92672">(){</span>
export AWS_ACCESS_KEY_ID<span style="color:#f92672">=</span>xxxx
export AWS_SECRET_ACCESS_KEY<span style="color:#f92672">=</span>xxxx
aws --region<span style="color:#f92672">=</span>cn-northwest-1 s3 cp  /data/mysql_data_bak/<span style="color:#e6db74">`</span>date +%F<span style="color:#e6db74">`</span>  s3://itbackups/confluence-jira-mysql/<span style="color:#e6db74">`</span>date +%F<span style="color:#e6db74">`</span>  --recursive
<span style="color:#f92672">}</span>

dump_db
upload_s3
<span style="color:#75715e">#load_db 2017-05-23</span>
</code></pre></div>
    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">Gourds</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
      2018-04-14
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="http://blog.gourds.site/tags/jira/">Jira</a>
          <a href="http://blog.gourds.site/tags/docker/">Docker</a>
          <a href="http://blog.gourds.site/tags/confluence/">Confluence</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/gitlab%E6%90%AD%E5%BB%BA%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">Gitlab搭建使用记录</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/fluentd%E4%BD%BF%E7%94%A8%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%A2%E6%95%B0%E6%8D%AE%E9%97%AE%E9%A2%98/">
            <span class="next-text nav-default">Fluentd使用中遇到的丢数据问题</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "Gourds/hugo_blog"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:gourds@yeah.net" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="http://gourds.github.com" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="http://localhost:1313" rel="me noopener" class="iconfont"
      title="zhihu"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M351.791182 562.469462l192.945407 0c0-45.367257-21.3871-71.939449-21.3871-71.939449L355.897709 490.530013c3.977591-82.182744 7.541767-187.659007 8.816806-226.835262l159.282726 0c0 0-0.86367-67.402109-18.578124-67.402109s-279.979646 0-279.979646 0 16.850783-88.141456 39.318494-127.053698c0 0-83.60514-4.510734-112.121614 106.962104S81.344656 355.077018 76.80834 367.390461c-4.536316 12.313443 24.62791 5.832845 36.941354 0 12.313443-5.832845 68.050885-25.924439 84.252893-103.69571l86.570681 0c1.165546 49.28652 4.596691 200.335724 3.515057 226.835262L109.86113 490.530013c-25.275663 18.147312-33.701566 71.939449-33.701566 71.939449L279.868105 562.469462c-8.497535 56.255235-23.417339 128.763642-44.275389 167.210279-33.05279 60.921511-50.55235 116.65793-169.802314 212.576513 0 0-19.442818 14.257725 40.829917 9.073656 60.273758-5.185093 117.305683-20.739347 156.840094-99.807147 20.553105-41.107233 41.805128-93.250824 58.386782-146.138358l-0.055259 0.185218 167.855986 193.263655c0 0 22.035876-51.847855 5.832845-108.880803L371.045711 650.610918l-42.1244 31.157627-0.045025 0.151449c11.69946-41.020252 20.11206-81.5749 22.726607-116.858498C351.665315 564.212152 351.72876 563.345412 351.791182 562.469462z"></path>
  <path d="M584.918753 182.033893l0 668.840094 70.318532 0 28.807093 80.512708 121.875768-80.512708 153.600307 0L959.520453 182.033893 584.918753 182.033893zM887.150192 778.934538l-79.837326 0-99.578949 65.782216-23.537066-65.782216-24.855084 0L659.341766 256.673847l227.807403 0L887.149169 778.934538z"></path>
</svg>

    </a>


<a href="http://blog.gourds.site/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2015 -
    2021
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        Gourds
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.dee43230127a73d039a734510fa896c89c3c7ce0cf0be0c7a7433f8fd69b76dc.js" integrity="sha256-3uQyMBJ6c9A5pzRRD6iWyJw8fODPC&#43;DHp0M/j9abdtw=" crossorigin="anonymous"></script>



  <script type="text/javascript">
    window.MathJax = {
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML' async></script>









  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  















</body>
</html>
